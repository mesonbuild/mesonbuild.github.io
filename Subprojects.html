<!DOCTYPE html>
<html lang="en">
<head>

<base href=".">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Subprojects</title>

<link rel="stylesheet" href="assets/css/custom_bootstrap.css" type="text/css">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" href="assets/js/search/enable_search.css" type="text/css">

<link rel="stylesheet" href="assets/css/prism-tomorrow.css" type="text/css">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/isotope.pkgd.min.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/trie.js"></script>
<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>

<link rel="icon" type="image/png" href="assets/images/favicon.png">
<link rel="shortcut icon" href="assets/images/favicon.png">

</head>

<body class="no-script
" data-spy="scroll" data-target="#toc" data-offset="70">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<form class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/meson_logo.png" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
  <a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Modules <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" id="modules-menu">
        <li>
            <a href="CMake-module.html">CMake</a>
        </li>
        <li>
            <a href="Cuda-module.html">CUDA</a>
        </li>
        <li>
            <a href="Dlang-module.html">Dlang</a>
        </li>
        <li>
            <a href="Fs-module.html">Filesystem</a>
        </li>
        <li>
            <a href="Gnome-module.html">GNOME</a>
        </li>
        <li>
            <a href="Hotdoc-module.html">Hotdoc</a>
        </li>
        <li>
            <a href="Icestorm-module.html">Icestorm</a>
        </li>
        <li>
            <a href="Keyval-module.html">Keyval</a>
        </li>
        <li>
            <a href="Pkgconfig-module.html">Pkgconfig</a>
        </li>
        <li>
            <a href="Python-3-module.html">Python 3</a>
        </li>
        <li>
            <a href="Python-module.html">Python</a>
        </li>
        <li>
            <a href="Qt4-module.html">Qt4</a>
        </li>
        <li>
            <a href="Qt5-module.html">Qt5</a>
        </li>
        <li>
            <a href="RPM-module.html">RPM</a>
        </li>
        <li>
            <a href="Rust-module.html">Rust</a>
        </li>
        <li>
            <a href="SourceSet-module.html">SourceSet</a>
        </li>
        <li>
            <a href="Windows-module.html">Windows</a>
        </li>
        <li>
            <a href="i18n-module.html">i18n</a>
        </li>
	</ul>
</li>
<li class="dropdown">
	<a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		Quick References <span class="caret"></span>
	</a>
	<ul class="dropdown-menu" id="quick-refs-menu">
					<li>
				<a href="Reference-manual.html">Functions</a>
			</li>
					<li>
				<a href="Build-options.html">Options</a>
			</li>
					<li>
				<a href="Configuration.html">Configuration</a>
			</li>
					<li>
				<a href="Dependencies.html">Dependencies</a>
			</li>
					<li>
				<a href="Unit-tests.html">Tests</a>
			</li>
					<li>
				<a href="Syntax.html">Syntax</a>
			</li>
			</ul>
</li>
			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
				<p><b>The Meson Build System</b></p>
			</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="core" data-hotdoc-in-toplevel="True" data-hotdoc-project="Meson-documentation" data-hotdoc-ref="Subprojects.html" class="page_container" id="page-wrapper">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/navigation.js"></script>
	<script src="assets/js/sitemap.js"></script>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-role="main">
        <h1 id="subprojects">Subprojects</h1>
<p>Some platforms do not provide a native packaging system. In these
cases it is common to bundle all third party libraries in your source
tree. This is usually frowned upon because it makes it hard to add
these kinds of projects into e.g. those Linux distributions that
forbid bundled libraries.</p>
<p>Meson tries to solve this problem by making it extremely easy to
provide both at the same time. The way this is done is that Meson
allows you to take any other Meson project and make it a part of your
build without (in the best case) any changes to its Meson setup. It
becomes a transparent part of the project.</p>
<p>It should be noted that this is only guaranteed to work for subprojects
that are built with Meson. The reason is the simple fact that there is
no possible way to do this reliably with mixed build systems. Because of
this, only meson subprojects are described here.
<a href="CMake-module.html#cmake-subprojects">CMake based subprojects</a> are also
supported but not guaranteed to work.</p>
<h2 id="a-subproject-example">A subproject example</h2>
<p>Usually dependencies consist of some header files plus a library to link against.
To declare this internal dependency use <code>declare_dependency</code> function.</p>
<p>As an example, suppose we have a simple project that provides a shared
library. Its <code>meson.build</code> would look like this.</p>
<pre><code class="language-meson">project('libsimple', 'c')

inc = include_directories('include')
libsimple = shared_library('simple',
  'simple.c',
  include_directories : inc,
  install : true)

libsimple_dep = declare_dependency(include_directories : inc,
  link_with : libsimple)
</code></pre>
<h3 id="naming-convention-for-dependency-variables">Naming convention for dependency variables</h3>
<p>Ideally the dependency variable name should be of <code>&lt;project_name&gt;_dep</code> form.
This way one can just use it without even looking inside build definitions of that subproject.</p>
<p>In cases where there are multiple dependencies need to be declared, the default one
should be named as <code>&lt;project_name&gt;_dep</code> (e.g. <code>gtest_dep</code>), and others can have
<code>&lt;project_name&gt;_&lt;other&gt;_&lt;name&gt;_dep</code> form (e.g. <code>gtest_main_dep</code> - gtest with main function).</p>
<p>There may be exceptions to these rules where common sense should be applied.</p>
<h3 id="adding-variables-to-the-dependency">Adding variables to the dependency</h3>
<p><em>New in 0.54.0</em></p>
<p>In some cases a project may define special variables via pkg-config or cmake
that a caller needs to know about. Meson provides a <code>dependency.get_variable</code>
method to hide what kind of dependency is provided, and this is available to
subprojects as well. Use the <code>variables</code> keyword to add a dict of strings:</p>
<pre><code class="language-meson">my_dep = declare_dependency(..., variables : {'var': 'value', 'number': '3'})
</code></pre>
<p>Which another project can access via:</p>
<pre><code class="language-meson">var = my_dep.get_variable(internal : 'var', cmake : 'CMAKE_VAR')
</code></pre>
<p>The values of the dict must be strings, as pkg-config and cmake will return
variables as strings.</p>
<h3 id="build-options-in-subproject">Build options in subproject</h3>
<p>All Meson features of the subproject, such as project options keep
working and can be set in the master project. There are a few
limitations, the most important being that global compiler arguments
must be set in the main project before calling subproject. Subprojects
must not set global arguments because there is no way to do that
reliably over multiple subprojects. To check whether you are running
as a subproject, use the <code>is_subproject</code> function.</p>
<h2 id="using-a-subproject">Using a subproject</h2>
<p>All subprojects must be inside <code>subprojects</code> directory.
The <code>subprojects</code> directory must be at the top level of your project.
Subproject declaration must be in your top level <code>meson.build</code>.</p>
<h3 id="a-simple-example">A simple example</h3>
<p>Let's use <code>libsimple</code> as a subproject.</p>
<p>At the top level of your project create <code>subprojects</code> directory.
Then copy <code>libsimple</code> into <code>subprojects</code> directory.</p>
<p>Your project's <code>meson.build</code> should look like this.</p>
<pre><code class="language-meson">project('my_project', 'cpp')

libsimple_proj = subproject('libsimple')
libsimple_dep = libsimple_proj.get_variable('libsimple_dep')

executable('my_project',
  'my_project.cpp',
  dependencies : libsimple_dep,
  install : true)
</code></pre>
<p>Note that the subproject object is <em>not</em> used as the dependency, but
rather you need to get the declared dependency from it with
<code>get_variable</code> because a subproject may have multiple declared
dependencies.</p>
<h3 id="toggling-between-system-libraries-and-embedded-sources">Toggling between system libraries and embedded sources</h3>
<p>When building distro packages it is very important that you do not
embed any sources. Some distros have a rule forbidding embedded
dependencies so your project must be buildable without them or
otherwise the packager will hate you.</p>
<p>Here's how you would use system libraries and fall back to embedding sources
if the dependency is not available.</p>
<pre><code class="language-meson">project('my_project', 'cpp')

libsimple_dep = dependency('libsimple', required : false)

if not libsimple_dep.found()
  libsimple_proj = subproject('libsimple')
  libsimple_dep = libsimple_proj.get_variable('libsimple_dep')
endif

executable('my_project',
  'my_project.cpp',
  dependencies : libsimple_dep,
  install : true)
</code></pre>
<p>Because this is such a common operation, Meson provides a shortcut for
this use case.</p>
<pre><code class="language-meson">dep = dependency('foo', fallback : [subproject_name, variable_name])
</code></pre>
<p>The <code>fallback</code> keyword argument takes two items, the name of the
subproject and the name of the variable that holds the dependency. If
you need to do something more complicated, such as extract several
different variables, then you need to do it yourself with the manual
method described above.</p>
<p>Using this shortcut the build definition would look like this.</p>
<pre><code class="language-meson">project('my_project', 'cpp')

libsimple_dep = dependency('libsimple', fallback : ['libsimple', 'libsimple_dep'])

executable('my_project',
  'my_project.cpp',
  dependencies : libsimple_dep,
  install : true)
</code></pre>
<p>With this setup when libsimple is provided by the system, we use it. When
that is not the case we use the embedded version (the one from subprojects).</p>
<p>Note that <code>libsimple_dep</code> can point to an external or an internal dependency but
you don't have to worry about their differences. Meson will take care
of the details for you.</p>
<h3 id="subprojects-depending-on-other-subprojects">Subprojects depending on other subprojects</h3>
<p>Subprojects can use other subprojects, but all subprojects must reside
in the top level <code>subprojects</code> directory. Recursive use of subprojects
is not allowed, though, so you can't have subproject <code>a</code> that uses
subproject <code>b</code> and have <code>b</code> also use <code>a</code>.</p>
<h2 id="obtaining-subprojects">Obtaining subprojects</h2>
<p>Meson ships with a dependency system to automatically obtain
dependency subprojects. It is documented in the <a href="Wrap-dependency-system-manual.html">Wrap dependency
system manual</a>.</p>
<h2 id="commandline-options">Command-line options</h2>
<p>The usage of subprojects can be controlled by users and distros with
the following command-line options:</p>
<ul>
<li>
<p><strong>--wrap-mode=nodownload</strong></p>
<p>Meson will not use the network to download any subprojects or
fetch any wrap information. Only pre-existing sources will be used.
This is useful (mostly for distros) when you want to only use the
sources provided by a software release, and want to manually handle
or provide missing dependencies.</p>
</li>
<li>
<p><strong>--wrap-mode=nofallback</strong></p>
<p>Meson will not use subproject fallbacks for any dependency
declarations in the build files, and will only look for them in the
system. Note that this does not apply to unconditional subproject()
calls, and those are meant to be used for sources that cannot be
provided by the system, such as copylibs.</p>
<p>This option may be overridden by <code>--force-fallback-for</code> for specific
dependencies.</p>
</li>
<li>
<p><strong>--wrap-mode=forcefallback</strong></p>
<p>Meson will not look at the system for any dependencies which have
subproject fallbacks available, and will <em>only</em> use subprojects for
them. This is useful when you want to test your fallback setup, or
want to specifically build against the library sources provided by
your subprojects.</p>
</li>
<li>
<p><strong>--force-fallback-for=list,of,dependencies</strong></p>
<p>Meson will not look at the system for any dependencies listed there,
provided a fallback was supplied when the dependency was declared.</p>
<p>This option takes precedence over <code>--wrap-mode=nofallback</code>, and when
used in combination with <code>--wrap-mode=nodownload</code> will only work
if the dependency has already been downloaded.</p>
<p>This is useful when your project has many fallback dependencies,
but you only want to build against the library sources for a few
of them.</p>
<p><strong>Warning</strong>: This could lead to mixing system and subproject version of the
same library in the same process. Take this case as example:</p>
<ul>
<li>Libraries <code>glib-2.0</code> and <code>gstreamer-1.0</code> are installed on your system.</li>
<li>
<code>gstreamer-1.0</code> depends on <code>glib-2.0</code>, pkg-config file <code>gstreamer-1.0.pc</code>
has <code>Requires: glib-2.0</code>.</li>
<li>In your application build definition you do:
<pre><code class="language-meson">executable('app', ...,
  dependencies: [
    dependency('glib-2.0', fallback: 'glib'),
    dependency('gstreamer-1.0', fallback: 'gstreamer')],
)
</code></pre>
</li>
<li>You configure with <code>--force-fallback-for=glib</code>.
This result in linking to two different versions of library <code>glib-2.0</code>
because <code>dependency('glib-2.0', fallback: 'glib')</code> will return the
subproject dependency, but <code>dependency('gstreamer-1.0', fallback: 'gstreamer')</code>
will not fallback and return the system dependency, including <code>glib-2.0</code>
library. To avoid that situation, every dependency that itself depend on
<code>glib-2.0</code> must also be forced to fallback, in this case with
<code>--force-fallback-for=glib,gsteamer</code>.</li>
</ul>
</li>
<li>
<p><strong>--wrap-mode=nopromote</strong></p>
<p><em>Since 0.56.0</em> Meson will automatically use wrap files found in subprojects
and copy them into the main project. That new behavior can be disabled by
passing <code>--wrap-mode=nopromote</code>. In that case only wraps found in the main
project will be used.</p>
</li>
</ul>
<h2 id="meson-subprojects-command">
<code>meson subprojects</code> command</h2>
<p><em>Since 0.49.0</em></p>
<p><code>meson subprojects</code> has various subcommands to manage all subprojects. If the
subcommand fails on any subproject the execution continues with other subprojects.
All subcommands accept <code>--sourcedir</code> argument pointing to the root source dir
of the main project.</p>
<p><em>Since 0.56.0</em> all subcommands accept <code>--types &lt;file|git|hg|svn&gt;</code> argument to
run the subcommands only on subprojects of the given types. Multiple types can
be set as comma separated list e.g. <code>--types git,file</code>.</p>
<p><em>Since 0.56.0</em> If the subcommand fails on any subproject an error code is returned
at the end instead of retuning success.</p>
<h3 id="download-subprojects">Download subprojects</h3>
<p><em>Since 0.49.0</em></p>
<p>Meson will automatically download needed subprojects during configure, unless
<strong>--wrap-mode=nodownload</strong> option is passed. It is sometimes preferable to
download all subprojects in advance, so the meson configure can be performed
offline. The command-line <code>meson subprojects download</code> can be used for that, it
will download all missing subprojects, but will not update already fetched
subprojects.</p>
<h3 id="update-subprojects">Update subprojects</h3>
<p><em>Since 0.49.0</em></p>
<p>Once a subproject has been fetched, Meson will not update it automatically.
For example if the wrap file tracks a git branch, it won't pull latest commits.</p>
<p>To pull latest version of all your subprojects at once, just run the command:
<code>meson subprojects update</code>.</p>
<ul>
<li>If the wrap file comes from wrapdb, the latest version of the wrap file will
be pulled and used next time meson reconfigure the project. This can be
triggered using <code>meson --reconfigure</code>. Previous source tree is not deleted, to
prevent from any loss of local changes.</li>
<li>If subproject is currently in detached mode, a checkout of the revision from
wrap file is performed. <em>Since 0.56.0</em> a rebase is also performed in case the
revision already existed locally but was outdated. If <code>--reset</code> is specified,
a hard reset is performed instead of rebase.</li>
<li>If subproject is currently at the same branch as specified by the wrap file,
a rebase on <code>origin</code> commit is performed. <em>Since 0.56.0</em> If <code>--reset</code> is
specified, a hard reset is performed instead of rebase.</li>
<li>If subproject is currently in a different branch as specified by the wrap file,
it is skipped unless <code>--rebase</code> option is passed in which case a rebase on
<code>origin</code> commit is performed. <em>Since 0.56.0</em> the <code>--rebase</code> argument is
deprecated and has no effect. Instead, a checkout of the revision from wrap file
file is performed and a rebase is also performed in case the revision already
existed locally by was outdated. If <code>--reset</code> is specified, a hard reset is
performed instead of rebase.</li>
<li>
<em>Since 0.56.0</em> if the <code>url</code> specified in wrap file is different to the URL set
on <code>origin</code> for a git repository it will not be updated, unless <code>--reset</code> is
specified in which case the URL of <code>origin</code> will be reset first.</li>
<li>
<em>Since 0.56.0</em> If the subproject directory is not a git repository but has a
<code>[wrap-git]</code> the subproject is ignored, unless <code>--reset</code> is specified in which
case the directory is deleted and the new repository is cloned.</li>
</ul>
<h3 id="start-a-topic-branch-across-all-git-subprojects">Start a topic branch across all git subprojects</h3>
<p><em>Since 0.49.0</em></p>
<p>The command-line <code>meson subprojects checkout &lt;branch_name&gt;</code> will checkout a
branch, or create one with <code>-b</code> argument, in every git subprojects. This is
useful when starting local changes across multiple subprojects. It is still your
responsibility to commit and push in each repository where you made local
changes.</p>
<p>To come back to the revision set in wrap file (i.e. master), just run
<code>meson subprojects checkout</code> with no branch name.</p>
<p><em>Since 0.56.0</em> any pending changes are now stashed before checkout a new branch.</p>
<h3 id="execute-a-command-on-all-subprojects">Execute a command on all subprojects</h3>
<p><em>Since 0.51.0</em></p>
<p>The command-line <code>meson subprojects foreach &lt;command&gt; [...]</code> will
execute a command in each subproject directory. For example this can be useful
to check the status of subprojects (e.g. with <code>git status</code> or <code>git diff</code>) before
performing other actions on them.</p>
<h2 id="why-must-all-subprojects-be-inside-a-single-directory">Why must all subprojects be inside a single directory?</h2>
<p>There are several reasons.</p>
<p>First of all, to maintain any sort of sanity, the system must prevent going
inside other subprojects with <code>subdir()</code> or variations thereof. Having the
subprojects in well defined places makes this easy. If subprojects could be
anywhere at all, it would be a lot harder.</p>
<p>Second of all it is extremely important that end users can easily see what
subprojects any project has. Because they are in one, and only one, place,
reviewing them becomes easy.</p>
<p>This is also a question of convention. Since all Meson projects have the same
layout w.r.t subprojects, switching between projects becomes easier. You don't
have to spend time on a new project traipsing through the source tree looking
for subprojects. They are always in the same place.</p>
<p>Finally if you can have subprojects anywhere, this increases the possibility of
having many different (possibly incompatible) versions of a dependency in your
source tree. Then changing some code (such as changing the order you traverse
directories) may cause a completely different version of the subproject to be
used by accident.</p>

    </div>
        




		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<div id="footer">
		    
        
<hr>

<div class="license-description">
    Website licensing information are available on the <a href="legal.html">Legal</a> page.
</div>


	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		<a href="https://github.com/mesonbuild/meson/edit/master/docs/markdown/Subprojects.md" data-hotdoc-role="edit-button">Edit on github</a>

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>


<script src="assets/js/navbar_offset_scroller.js"></script>
</body>
</html>
