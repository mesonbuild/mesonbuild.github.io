<!DOCTYPE html>
<html lang="en">
<head>

<base href=".">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Vala</title>

<link rel="stylesheet" href="assets/css/dark-frontend.css" type="text/css" title="dark">
<link rel="alternate stylesheet" href="assets/css/light-frontend.css" type="text/css" title="light">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" href="assets/js/search/enable_search.css" type="text/css">

<link rel="stylesheet" href="assets/css/notes.css" type="text/css">
<link rel="stylesheet" href="assets/css/devhelp.css" type="text/css">

<link rel="stylesheet" href="assets/css/prism-tomorrow.css" type="text/css" title="dark">

<link rel="alternate stylesheet" href="assets/css/prism.css" type="text/css" title="light">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>
<script src="assets/js/styleswitcher.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/prism-keep-markup.js"></script>
<script src="assets/js/trie.js"></script>

<link rel="icon" type="image/png" href="assets/images/favicon.png">
<link rel="shortcut icon" href="assets/images/favicon.png">

</head>

<body class="no-script
">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<span title="light mode switch" class="glyphicon glyphicon-sunglasses pull-right" id="lightmode-icon"></span>
			<form class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/meson_logo.png" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
  <a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Modules <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" id="modules-menu">
        <li>
            <a href="CMake-module.html">CMake</a>
        </li>
        <li>
            <a href="Codegen-module.html">Codegen</a>
        </li>
        <li>
            <a href="Cuda-module.html">CUDA</a>
        </li>
        <li>
            <a href="Dlang-module.html">Dlang</a>
        </li>
        <li>
            <a href="External-Project-module.html">External Project</a>
        </li>
        <li>
            <a href="Fs-module.html">Filesystem</a>
        </li>
        <li>
            <a href="Gnome-module.html">GNOME</a>
        </li>
        <li>
            <a href="Hotdoc-module.html">Hotdoc</a>
        </li>
        <li>
            <a href="i18n-module.html">i18n</a>
        </li>
        <li>
            <a href="Icestorm-module.html">Icestorm</a>
        </li>
        <li>
            <a href="Java-module.html">Java</a>
        </li>
        <li>
            <a href="Keyval-module.html">Keyval</a>
        </li>
        <li>
            <a href="Pkgconfig-module.html">Pkgconfig</a>
        </li>
        <li>
            <a href="Python-3-module.html">Python 3</a>
        </li>
        <li>
            <a href="Python-module.html">Python</a>
        </li>
        <li>
            <a href="Qt4-module.html">Qt4</a>
        </li>
        <li>
            <a href="Qt5-module.html">Qt5</a>
        </li>
        <li>
            <a href="Qt6-module.html">Qt6</a>
        </li>
        <li>
            <a href="Rust-module.html">Rust</a>
        </li>
        <li>
            <a href="Simd-module.html">Simd</a>
        </li>
        <li>
            <a href="Snippets-module.html">Snippets</a>
        </li>
        <li>
            <a href="SourceSet-module.html">SourceSet</a>
        </li>
        <li>
            <a href="Wayland-module.html">Wayland</a>
        </li>
        <li>
            <a href="Windows-module.html">Windows</a>
        </li>
	</ul>
</li>
<li class="dropdown">
	<a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		Quick References <span class="caret"></span>
	</a>
	<ul class="dropdown-menu" id="quick-refs-menu">
					<li>
				<a href="Reference-manual.html">Functions</a>
			</li>
					<li>
				<a href="Build-options.html">Options</a>
			</li>
					<li>
				<a href="Configuration.html">Configuration</a>
			</li>
					<li>
				<a href="Dependencies.html">Dependencies</a>
			</li>
					<li>
				<a href="Unit-tests.html">Tests</a>
			</li>
					<li>
				<a href="Syntax.html">Syntax</a>
			</li>
			</ul>
</li>
			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
				<p><b>The Meson Build System</b></p>
			</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="core" data-hotdoc-in-toplevel="True" data-hotdoc-project="Meson-documentation" data-hotdoc-ref="Vala.html" class="page_container" id="page-wrapper">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/full-width.js"></script>
  <div id="sitenav-wrapper">
    <iframe src="hotdoc-sitemap.html" id="sitenav-frame"></iframe>
  </div>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-role="main">
        <h1 id="compiling-vala-applications-and-libraries">Compiling Vala applications and libraries</h1>
<p>Meson supports compiling applications and libraries written in
<a href="https://vala-project.org/">Vala</a> and
<a href="https://wiki.gnome.org/Projects/Genie">Genie</a> . A skeleton <code>meson.build</code> file:</p>
<pre><code class="language-meson">project('vala app', 'vala', 'c')

dependencies = [
    dependency('glib-2.0'),
    dependency('gobject-2.0'),
]

sources = files('app.vala')

executable('app_name', sources, dependencies: dependencies)
</code></pre>
<p>You must always specify the <code>glib-2.0</code> and <code>gobject-2.0</code> libraries as
dependencies, because all current Vala applications use them.
<a href="https://developer.gnome.org/glib/stable/">GLib</a> is used for basic data types
and <a href="https://developer.gnome.org/gobject/stable/">GObject</a> is used for the
runtime type system.</p>
<h2 id="using-libraries">Using libraries</h2>
<p>Meson uses the <a href="Reference-manual_functions.html#dependency"><ins><code>dependency()</code></ins></a>
function to find the relevant VAPI, C headers and linker flags when it
encounters a Vala source file in a build target. Vala needs a VAPI
file and a C header or headers to use a library. The VAPI file helps
map Vala code to the library's C programming interface. It is the
<a href="https://www.freedesktop.org/wiki/Software/pkg-config/"><code>pkg-config</code></a>
tool that makes finding these installed files all work seamlessly
behind the scenes. When a <code>pkg-config</code> file doesn't exist for the
library then the <code>find_library()</code>
method of the <a href="Reference-manual_returned_compiler.html"><ins><code>compiler</code></ins></a> object
needs to be used. Examples are given later.</p>
<p>Note Vala uses libraries that follow the C Application Binary Interface (C ABI).
The library, however, could be written in C, Vala, Rust, Go, C++ or any other
language that can generate a binary compatible with the C ABI and so provides C
headers.</p>
<h3 id="the-simplest-case">The simplest case</h3>
<p>This first example is a simple addition to the <code>meson.build</code> file because:</p>
<ul>
<li>the library has a <code>pkg-config</code> file, <code>gtk+-3.0.pc</code>
</li>
<li>the VAPI is distributed with Vala and so installed with the Vala compiler</li>
<li>the VAPI is installed in Vala's standard search path</li>
<li>the VAPI, <code>gtk+-3.0.vapi</code>, has the same name as the <code>pkg-config</code> file</li>
</ul>
<p>Everything works seamlessly in the background and only a single extra line is
needed:</p>
<pre><code class="language-meson">project('vala app', 'vala', 'c')

dependencies = [
    dependency('glib-2.0'),
    dependency('gobject-2.0'),
    dependency('gtk+-3.0'),
]

sources = files('app.vala')

executable('app_name', sources, dependencies: dependencies)
</code></pre>
<p>GTK+ is the graphical toolkit used by GNOME, elementary OS and other
desktop environments. The binding to the library, the VAPI file, is
distributed with Vala.</p>
<p>Other libraries may have a VAPI that is distributed with the library
itself. Such libraries will have their VAPI file installed along with
their other development files. The VAPI is installed in Vala's
standard search path and so works just as seamlessly using the
<code>dependency()</code> function.</p>
<h3 id="targeting-a-version-of-glib">Targeting a version of GLib</h3>
<p>Meson's <a href="Reference-manual_functions.html#dependency"><ins><code>dependency()</code></ins></a> function
allows a version check of a library. This is often used to check a
minimum version is installed. When setting a minimum version of GLib,
Meson will also pass this to the Vala compiler using the
<code>--target-glib</code> option.</p>
<p>This is needed when using GTK+'s user interface definition files with
Vala's <code>[GtkTemplate]</code>, <code>[GtkChild]</code> and <code>[GtkCallback]</code> attributes.
This requires <code>--target-glib 2.38</code>, or a newer version, to be passed
to Vala. With Meson this is simply done with:</p>
<pre><code class="language-meson">project('vala app', 'vala', 'c')

dependencies = [
    dependency('glib-2.0', version: '&gt;=2.38'),
    dependency('gobject-2.0'),
    dependency('gtk+-3.0'),
]

sources = files('app.vala')

executable('app_name', sources, dependencies: dependencies)
</code></pre>
<p>Using <code>[GtkTemplate]</code> also requires the GTK+ user interface definition
files to be built into the binary as GResources. For completeness,
the next example shows this:</p>
<pre><code class="language-meson">project('vala app', 'vala', 'c')

dependencies = [
    dependency('glib-2.0', version: '&gt;=2.38'),
    dependency('gobject-2.0'),
    dependency('gtk+-3.0'),
]

sources = files('app.vala')

sources += import( 'gnome' ).compile_resources(
    'project-resources',
    'src/resources/resources.gresource.xml',
    source_dir: 'src/resources',
)

executable('app_name', sources, dependencies: dependencies)
</code></pre>
<h3 id="adding-to-valas-search-path">Adding to Vala's search path</h3>
<p>So far we have covered the cases where the VAPI file is either
distributed with Vala or the library. A VAPI can also be included in
the source files of your project. The convention is to put it in the
<code>vapi</code> directory of your project.</p>
<p>This is needed when a library does not have a VAPI or your project
needs to link to another component in the project that uses the C ABI.
For example if part of the project is written in C.</p>
<p>The Vala compiler's <code>--vapidir</code> option is used to add the project
directory to the VAPI search path. In Meson this is done with the
<code>add_project_arguments()</code> function:</p>
<pre><code class="language-meson">project('vala app', 'vala', 'c')

vapi_dir = meson.current_source_dir() / 'vapi'

add_project_arguments(['--vapidir', vapi_dir], language: 'vala')

dependencies = [
    dependency('glib-2.0'),
    dependency('gobject-2.0'),
    dependency('foo'), # 'foo.vapi' will be resolved as './vapi/foo.vapi'
]

sources = files('app.vala')

executable('app_name', sources, dependencies: dependencies)
</code></pre>
<p>If the VAPI is for an external library then make sure that the VAPI
name corresponds to the pkg-config file name.</p>
<p>The <a href="https://gitlab.gnome.org/GNOME/vala-extra-vapis"><code>vala-extra-vapis</code>
repository</a> is a
community maintained repository of VAPIs that are not distributed.
Developers use the repository to share early work on new bindings and
improvements to existing bindings. So the VAPIs can frequently change.
It is recommended VAPIs from this repository are copied into your
project's source files.</p>
<p>This also works well for starting to write new bindings before they
are shared with the <code>vala-extra-vapis</code> repository.</p>
<h3 id="libraries-without-pkgconfig-files">Libraries without pkg-config files</h3>
<p>A library that does not have a corresponding pkg-config file may mean
<code>dependency()</code> is unsuitable for finding the C and Vala interface
files. In this case it is necessary to use the <code>find_library()</code> method
of the compiler object.</p>
<p>The first example uses Vala's POSIX binding. There is no pkg-config
file because POSIX includes the standard C library on Unix systems.
All that is needed is the VAPI file, <code>posix.vapi</code>. This is included
with Vala and installed in Vala's standard search path. Meson just
needs to be told to only find the library for the Vala compiler:</p>
<pre><code class="language-meson">project('vala app', 'vala', 'c')

dependencies = [
    dependency('glib-2.0'),
    dependency('gobject-2.0'),
    meson.get_compiler('vala').find_library('posix'),
]

sources = files('app.vala')

executable('app_name', sources, dependencies: dependencies)
</code></pre>
<p>The next example shows how to link with a C library where no
additional VAPI is needed. The standard maths functions are already
bound in <code>glib-2.0.vapi</code>, but the GNU C library requires linking to
the maths library separately. In this example Meson is told to find
the library only for the C compiler:</p>
<pre><code class="language-meson">project('vala app', 'vala', 'c')

dependencies = [
    dependency('glib-2.0'),
    dependency('gobject-2.0'),
    meson.get_compiler('c').find_library('m', required: false),
]

sources = files('app.vala')

executable('app_name', sources, dependencies: dependencies)
</code></pre>
<p>The <code>required: false</code> means the build will continue when using another
C library that does not separate the maths library. See <a href="howtox.html#add-math-library-lm-portably">Add math
library (-lm) portably</a>.</p>
<p>The final example shows how to use a library that does not have a
pkg-config file and the VAPI is in the <code>vapi</code> directory of your
project source files:</p>
<pre><code class="language-meson">project('vala app', 'vala', 'c')

vapi_dir = meson.current_source_dir() / 'vapi'

add_project_arguments(['--vapidir', vapi_dir], language: 'vala')

dependencies = [
    dependency('glib-2.0'),
    dependency('gobject-2.0'),
    meson.get_compiler('c').find_library('foo'),
    meson.get_compiler('vala').find_library('foo', dirs: vapi_dir),
]

sources = files('app.vala')

executable('app_name', sources, dependencies: dependencies)
</code></pre>
<p>The <code>find_library()</code> method of the C compiler object will try to find the C
header files and the library to link with.</p>
<p>The <code>find_library()</code> method of the Vala compiler object needs to have the <code>dir</code>
keyword added to include the project VAPI directory. This is not added
automatically by <code>add_project_arguments()</code>.</p>
<h3 id="working-with-the-vala-preprocessor">Working with the Vala Preprocessor</h3>
<p>Passing arguments to <a href="https://wiki.gnome.org/Projects/Vala/Manual/Preprocessor">Vala's
preprocessor</a>
requires specifying the language as <code>vala</code>. For example, the following
statement sets the preprocessor symbol <code>USE_FUSE</code>:</p>
<pre><code class="language-meson">add_project_arguments('-D', 'USE_FUSE', language: 'vala')
</code></pre>
<p>If you need to pass an argument to the C pre-processor then specify
the language as c. For example to set FUSE_USE_VERSION to 26 use:</p>
<pre><code class="language-meson">add_project_arguments('-DFUSE_USE_VERSION=26', language: 'c')
</code></pre>
<h2 id="building-libraries">Building libraries</h2>
<h3 id="changing-c-header-and-vapi-names">Changing C header and VAPI names</h3>
<p>Meson's <a href="Reference-manual_functions.html#library"><ins><code>library()</code></ins></a> target automatically
outputs the C header and the VAPI. They can be renamed by setting the
<code>vala_header</code> and <code>vala_vapi</code> arguments respectively:</p>
<pre><code class="language-meson">foo_lib = shared_library('foo', 'foo.vala',
                  vala_header: 'foo.h',
                  vala_vapi: 'foo-1.0.vapi',
                  dependencies: [glib_dep, gobject_dep],
                  install: true,
                  install_dir: [true, true, true])
</code></pre>
<p>In this example, the second and third elements of the <code>install_dir</code>
array indicate the destination with <code>true</code> to use default directories
(i.e. <code>include</code> and <code>share/vala/vapi</code>).</p>
<h3 id="depending-on-c-header">Depending on C header</h3>
<p><em>(since 1.10.0)</em></p>
<p>Given the previous example,</p>
<pre><code class="language-meson">foo_lib = shared_library(...)
foo_h = foo_lib.vala_header()
</code></pre>
<p>This header can now be used like any other generated header to create an
order-only dependency.</p>
<h3 id="depending-on-vapi-header">Depending on VAPI header</h3>
<p><em>(since 1.10.0)</em></p>
<p>Given the previous example,</p>
<pre><code class="language-meson">foo_lib = shared_library(...)
foo_vapi = foo_lib.vala_vapi()
</code></pre>
<h3 id="depending-on-generated-gir">Depending on generated GIR</h3>
<p><em>(since 1.10.0)</em></p>
<pre><code class="language-meson">foo_lib = shared_library(..., vala_gir : 'foo.gir')
foo_gir = foo_lib.vala_gir()
</code></pre>
<h3 id="gobject-introspection-and-language-bindings">GObject Introspection and language bindings</h3>
<p>A 'binding' allows another programming language to use a library
written in Vala. Because Vala uses the GObject type system as its
runtime type system it is very easy to use introspection to generate a
binding. A Meson build of a Vala library can generate the GObject
introspection metadata. The metadata is then used in separate projects
with <a href="https://wiki.gnome.org/Projects/Vala/LibraryWritingBindings">language specific
tools</a> to
generate a binding.</p>
<p>The main form of metadata is a GObject Introspection Repository (GIR)
XML file. GIRs are mostly used by languages that generate bindings at
compile time. Languages that generate bindings at runtime mostly use a
typelib file, which is generated from the GIR.</p>
<p>Meson can generate a GIR as part of the build. For a Vala library the
<code>vala_gir</code> option has to be set for the <code>library</code>:</p>
<pre><code class="language-meson">foo_lib = shared_library('foo', 'foo.vala',
                  vala_gir: 'Foo-1.0.gir',
                  dependencies: [glib_dep, gobject_dep],
                  install: true,
                  install_dir: [true, true, true, true])
</code></pre>
<p>The <code>true</code> value in <code>install_dir</code> tells Meson to use the default
directory (i.e. <code>share/gir-1.0</code> for GIRs). The fourth element in the
<code>install_dir</code> array indicates where the GIR file will be installed.</p>
<p>To then generate a typelib file use a custom target with the
<code>g-ir-compiler</code> program and a dependency on the library:</p>
<p><em>Since Meson 1.10</em>, use the <code>.vala_gir()</code> method to get a handle to the generated <code>.gir</code> file:</p>
<pre><code class="language-meson">g_ir_compiler = find_program('g-ir-compiler')
custom_target('foo typelib', command: [g_ir_compiler, '--output', '@OUTPUT@', '@INPUT@'],
              input: foo_lib.vala_gir(),
              output: 'Foo-1.0.typelib',
              install: true,
              install_dir: get_option('libdir') / 'girepository-1.0')
</code></pre>
<p><em>Before Meson 1.10</em>, calculating the path to the input is required, as is adding a
manual dependency to the vala target:</p>
<pre><code class="language-meson">g_ir_compiler = find_program('g-ir-compiler')
custom_target('foo typelib', command: [g_ir_compiler, '--output', '@OUTPUT@', '@INPUT@'],
              input: meson.current_build_dir() / 'Foo-1.0.gir',
              output: 'Foo-1.0.typelib',
              depends: foo_lib,
              install: true,
              install_dir: get_option('libdir') / 'girepository-1.0')
</code></pre>

    </div>
        




		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<div id="footer">
		    
        
<hr>

<div class="license-description">
    Website licensing information are available on the <a href="legal.html">Legal</a> page.
</div>


	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		<a href="https://github.com/mesonbuild/meson/edit/master/docs/markdown/Vala.md" data-hotdoc-role="edit-button">Edit on GitHub</a>

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>


<script src="assets/js/navbar_offset_scroller.js"></script>
</body>
</html>
