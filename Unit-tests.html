<!DOCTYPE html>
<html lang="en">
<head>

<base href=".">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Unit tests</title>

<link rel="stylesheet" href="assets/css/custom_bootstrap.css" type="text/css">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" href="assets/js/search/enable_search.css" type="text/css">

<link rel="stylesheet" href="assets/css/prism-tomorrow.css" type="text/css">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/isotope.pkgd.min.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/trie.js"></script>

<link rel="icon" type="image/png" href="assets/images/favicon.png">
<link rel="shortcut icon" href="assets/images/favicon.png">

</head>

<body class="no-script
" data-spy="scroll" data-target="#toc" data-offset="70">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<form class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/meson_logo.png" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
  <a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Modules <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" id="modules-menu">
			<li>
				<a href="CMake-module.html">CMake</a>
			</li>
					<li>
				<a href="Cuda-module.html">CUDA</a>
			</li>
					<li>
				<a href="Dlang-module.html">Dlang</a>
			</li>
					<li>
				<a href="Fs-module.html">Filesystem</a>
			</li>
					<li>
				<a href="Gnome-module.html">GNOME</a>
			</li>
					<li>
				<a href="Hotdoc-module.html">Hotdoc</a>
			</li>
					<li>
				<a href="i18n-module.html">i18n</a>
			</li>
					<li>
				<a href="Icestorm-module.html">Icestorm</a>
			</li>
					<li>
				<a href="Keyval-module.html">Keyval</a>
			</li>
					<li>
				<a href="Pkgconfig-module.html">Pkgconfig</a>
			</li>
					<li>
				<a href="Python-module.html">Python</a>
			</li>
					<li>
				<a href="Python-3-module.html">Python 3</a>
			</li>
					<li>
				<a href="Qt4-module.html">Qt4</a>
			</li>
					<li>
				<a href="Qt5-module.html">Qt5</a>
			</li>
					<li>
				<a href="RPM-module.html">RPM</a>
			</li>
					<li>
				<a href="SourceSet-module.html">SourceSet</a>
			</li>
					<li>
				<a href="Windows-module.html">Windows</a>
			</li>
			</ul>
</li>
<li class="dropdown">
	<a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		Quick References <span class="caret"></span>
	</a>
	<ul class="dropdown-menu" id="quick-refs-menu">
					<li>
				<a href="Reference-manual.html">Functions</a>
			</li>
					<li>
				<a href="Build-options.html">Options</a>
			</li>
					<li>
				<a href="Configuration.html">Configuration</a>
			</li>
					<li>
				<a href="Dependencies.html">Dependencies</a>
			</li>
					<li>
				<a href="Unit-tests.html">Tests</a>
			</li>
					<li>
				<a href="Syntax.html">Syntax</a>
			</li>
			</ul>
</li>
			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
				<p><b>The Meson Build System</b></p>
			</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="core" data-hotdoc-in-toplevel="True" data-hotdoc-project="Meson-documentation" data-hotdoc-ref="Unit-tests.html" class="page_container" id="page-wrapper">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/navigation.js"></script>
	<script src="assets/js/sitemap.js"></script>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-role="main">
        <h1 id="unit-tests">Unit tests</h1>
<p>Meson comes with a fully functional unit test system. To use it simply build
an executable and then use it in a test.</p>
<pre><code class="language-meson">e = executable('prog', 'testprog.c')
test('name of test', e)
</code></pre>
<p>You can add as many tests as you want. They are run with the command <code>meson test</code>.</p>
<p>Meson captures the output of all tests and writes it in the log file
<code>meson-logs/testlog.txt</code>.</p>
<h2 id="test-parameters">Test parameters</h2>
<p>Some tests require the use of command line arguments or environment
variables. These are simple to define.</p>
<pre><code class="language-meson">test('command line test', exe, args : ['first', 'second'])
test('envvar test', exe2, env : ['key1=value1', 'key2=value2'])
</code></pre>
<p>Note how you need to specify multiple values as an array.</p>
<h3 id="malloc_perturb_">MALLOC_PERTURB_</h3>
<p>By default, environment variable
<a href="http://man7.org/linux/man-pages/man3/mallopt.3.html"><code>MALLOC_PERTURB_</code></a> is
set to a random value between 1..255. This can help find memory leaks on
configurations using glibc, including with non-GCC compilers. This feature
can be disabled as discussed in <a href="Reference-manual.html#test">test()</a>.</p>
<h2 id="coverage">Coverage</h2>
<p>If you enable coverage measurements by giving Meson the command line flag
<code>-Db_coverage=true</code>, you can generate coverage reports after running the
tests (running the tests is required to gather the list of functions that get
called). Meson will autodetect what coverage generator tools you have
installed and will generate the corresponding targets. These targets are
<code>coverage-xml</code> and <code>coverage-text</code> which are both provided by
<a href="http://gcovr.com">Gcovr</a> (version 3.3 or higher) and <code>coverage-html</code>, which
requires <a href="https://ltp.sourceforge.io/coverage/lcov.php">Lcov</a> and
<a href="https://linux.die.net/man/1/genhtml">GenHTML</a> or <a href="http://gcovr.com">Gcovr</a>.
As a convenience, a high-level <code>coverage</code> target is also generated which will
produce all 3 coverage report types, if possible.</p>
<p>The output of these commands is written to the log directory <code>meson-logs</code> in
your build directory.</p>
<h2 id="parallelism">Parallelism</h2>
<p>To reduce test times, Meson will by default run multiple unit tests in
parallel. It is common to have some tests which can not be run in parallel
because they require unique hold on some resource such as a file or a D-Bus
name. You have to specify these tests with a keyword argument.</p>
<pre><code class="language-meson">test('unique test', t, is_parallel : false)
</code></pre>
<p>Meson will then make sure that no other unit test is running at the same
time. Non-parallel tests take longer to run so it is recommended that you
write your unit tests to be parallel executable whenever possible.</p>
<p>By default Meson uses as many concurrent processes as there are cores on the
test machine. You can override this with the environment variable
<code>MESON_TESTTHREADS</code> like this.</p>
<pre><code class="language-console">$ MESON_TESTTHREADS=5 meson test
</code></pre>
<h2 id="priorities">Priorities</h2>
<p><em>(added in version 0.52.0)</em></p>
<p>Tests can be assigned a priority that determines when a test is <em>started</em>.
Tests with higher priority are started first, tests with lower priority
started later. The default priority is 0, meson makes no guarantee on the
ordering of tests with identical priority.</p>
<pre><code class="language-meson">test('started second', t, priority : 0)
test('started third', t, priority : -50)
test('started first', t, priority : 1000)
</code></pre>
<p>Note that the test priority only affects the starting order of tests and
subsequent tests are affected by how long it takes previous tests to
complete. It is thus possible that a higher-priority test is still running
when lower-priority tests with a shorter runtime have completed.</p>
<h2 id="skipped-tests-and-hard-errors">Skipped tests and hard errors</h2>
<p>Sometimes a test can only determine at runtime that it can not be run.</p>
<p>For the default <code>exitcode</code> testing protocol, the GNU standard approach in
this case is to exit the program with error code 77. Meson will detect this
and report these tests as skipped rather than failed. This behavior was added
in version 0.37.0.</p>
<p>For TAP-based tests, skipped tests should print a single line starting with
<code>1..0 # SKIP</code>.</p>
<p>In addition, sometimes a test fails set up so that it should fail even if it
is marked as an expected failure. The GNU standard approach in this case is
to exit the program with error code 99. Again, Meson will detect this and
report these tests as <code>ERROR</code>, ignoring the setting of <code>should_fail</code>. This
behavior was added in version 0.50.0.</p>
<h2 id="testing-tool">Testing tool</h2>
<p>The goal of the meson test tool is to provide a simple way to run tests in a
variety of different ways. The tool is designed to be run in the build
directory.</p>
<p>The simplest thing to do is just to run all tests.</p>
<pre><code class="language-console">$ meson test
</code></pre>
<h3 id="run-subsets-of-tests">Run subsets of tests</h3>
<p>For clarity, consider the meson.build containing:</p>
<pre><code class="language-meson">
test('A', ..., suite: 'foo')
test('B', ..., suite: ['foo', 'bar'])
test('C', ..., suite: 'bar')
test('D', ..., suite: 'baz')

</code></pre>
<p>Specify test(s) by name like:</p>
<pre><code class="language-console">$ meson test A D
</code></pre>
<p>Tests belonging to a suite <code>suite</code> can be run as follows</p>
<pre><code class="language-console">$ meson test --suite (sub)project_name:suite
</code></pre>
<p>Since version <em>0.46</em>, <code>(sub)project_name</code> can be omitted if it is the
top-level project.</p>
<p>Multiple suites are specified like:</p>
<pre><code class="language-console">$ meson test --suite foo --suite bar
</code></pre>
<p>NOTE: If you choose to specify both suite(s) and specific test name(s), the
test name(s) must be contained in the suite(s). This however is redundant--
it would be more useful to specify either specific test names or suite(s).</p>
<h3 id="other-test-options">Other test options</h3>
<p>Sometimes you need to run the tests multiple times, which is done like this:</p>
<pre><code class="language-console">$ meson test --repeat=10
</code></pre>
<p>Invoking tests via a helper executable such as Valgrind can be done with the
<code>--wrap</code> argument</p>
<pre><code class="language-console">$ meson test --wrap=valgrind testname
</code></pre>
<p>Arguments to the wrapper binary can be given like this:</p>
<pre><code class="language-console">$ meson test --wrap='valgrind --tool=helgrind' testname
</code></pre>
<p>Meson also supports running the tests under GDB. Just doing this:</p>
<pre><code class="language-console">$ meson test --gdb testname
</code></pre>
<p>Meson will launch <code>gdb</code> all set up to run the test. Just type <code>run</code> in the
GDB command prompt to start the program.</p>
<p>The second use case is a test that segfaults only rarely. In this case you
can invoke the following command:</p>
<pre><code class="language-console">$ meson test --gdb --repeat=10000 testname
</code></pre>
<p>This runs the test up to 10 000 times under GDB automatically. If the program
crashes, GDB will halt and the user can debug the application. Note that
testing timeouts are disabled in this case so <code>meson test</code> will not kill
<code>gdb</code> while the developer is still debugging it. The downside is that if the
test binary freezes, the test runner will wait forever.</p>
<p>Sometimes, the GDB binary is not in the PATH variable or the user wants to
use a GDB replacement. Therefore, the invoked GDB program can be specified
<em>(added 0.52.0)</em>:</p>
<pre><code class="language-console">$ meson test --gdb --gdb-path /path/to/gdb testname
</code></pre>
<pre><code class="language-console">$ meson test --print-errorlogs
</code></pre>
<p>Meson will report the output produced by the failing tests along with other
useful information as the environmental variables. This is useful, for
example, when you run the tests on Travis-CI, Jenkins and the like.</p>
<p>For further information see the command line help of Meson by running <code>meson test -h</code>.</p>
<h2 id="legacy-notes">Legacy notes</h2>
<p>If <code>meson test</code> does not work for you, you likely have a old version of
Meson. In that case you should call <code>mesontest</code> instead. If <code>mesontest</code>
doesn't work either you have a very old version prior to 0.37.0 and should
upgrade.</p>
<h2 id="test-outputs">Test outputs</h2>
<p>Meson will write several different files with detailed results of running
tests. These will be written into $builddir/meson-logs/</p>
<h3 id="testlogjson">testlog.json</h3>
<p>This is not a proper json file, but a file containing one valid json object
per line. This is file is designed so each line is streamed out as each test
is run, so it can be read as a stream while the test harness is running</p>
<h3 id="testlogjunitxml">testlog.junit.xml</h3>
<p>This is a valid JUnit XML description of all tests run. It is not streamed
out, and is written only once all tests complete running.</p>
<p>When tests use the <code>tap</code> protocol each test will be recorded as a testsuite
container, with each case named by the number of the result.</p>
<p>When tests use the <code>gtest</code> protocol meson will inject arguments to the test
to generate it's own JUnit XML, which meson will include as part of this XML
file.</p>
<p><em>New in 0.55.0</em></p>

    </div>
        




		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<div id="footer">
		    
        
<hr>

<div class="license-description">
    Website licensing information are available on the <a href="legal.html">Legal</a> page.
</div>


	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		<a href="https://github.com/mesonbuild/meson/edit/master/docs/builddir/markdown/Unit-tests.md" data-hotdoc-role="edit-button">Edit on github</a>

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>


<script src="assets/js/navbar_offset_scroller.js"></script>
</body>
</html>
