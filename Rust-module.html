<!DOCTYPE html>
<html lang="en">
<head>

<base href=".">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Rust module</title>

<link rel="stylesheet" href="assets/css/dark-frontend.css" type="text/css" title="dark">
<link rel="alternate stylesheet" href="assets/css/light-frontend.css" type="text/css" title="light">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" href="assets/js/search/enable_search.css" type="text/css">

<link rel="stylesheet" href="assets/css/notes.css" type="text/css">
<link rel="stylesheet" href="assets/css/devhelp.css" type="text/css">

<link rel="stylesheet" href="assets/css/prism-tomorrow.css" type="text/css" title="dark">

<link rel="alternate stylesheet" href="assets/css/prism.css" type="text/css" title="light">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>
<script src="assets/js/styleswitcher.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/prism-keep-markup.js"></script>
<script src="assets/js/trie.js"></script>

<link rel="icon" type="image/png" href="assets/images/favicon.png">
<link rel="shortcut icon" href="assets/images/favicon.png">

</head>

<body class="no-script
">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<span title="light mode switch" class="glyphicon glyphicon-sunglasses pull-right" id="lightmode-icon"></span>
			<form class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/meson_logo.png" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
  <a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Modules <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" id="modules-menu">
        <li>
            <a href="CMake-module.html">CMake</a>
        </li>
        <li>
            <a href="Codegen-module.html">Codegen</a>
        </li>
        <li>
            <a href="Cuda-module.html">CUDA</a>
        </li>
        <li>
            <a href="Dlang-module.html">Dlang</a>
        </li>
        <li>
            <a href="External-Project-module.html">External Project</a>
        </li>
        <li>
            <a href="Fs-module.html">Filesystem</a>
        </li>
        <li>
            <a href="Gnome-module.html">GNOME</a>
        </li>
        <li>
            <a href="Hotdoc-module.html">Hotdoc</a>
        </li>
        <li>
            <a href="i18n-module.html">i18n</a>
        </li>
        <li>
            <a href="Icestorm-module.html">Icestorm</a>
        </li>
        <li>
            <a href="Java-module.html">Java</a>
        </li>
        <li>
            <a href="Keyval-module.html">Keyval</a>
        </li>
        <li>
            <a href="Pkgconfig-module.html">Pkgconfig</a>
        </li>
        <li>
            <a href="Python-3-module.html">Python 3</a>
        </li>
        <li>
            <a href="Python-module.html">Python</a>
        </li>
        <li>
            <a href="Qt4-module.html">Qt4</a>
        </li>
        <li>
            <a href="Qt5-module.html">Qt5</a>
        </li>
        <li>
            <a href="Qt6-module.html">Qt6</a>
        </li>
        <li>
            <a href="Rust-module.html">Rust</a>
        </li>
        <li>
            <a href="Simd-module.html">Simd</a>
        </li>
        <li>
            <a href="Snippets-module.html">Snippets</a>
        </li>
        <li>
            <a href="SourceSet-module.html">SourceSet</a>
        </li>
        <li>
            <a href="Wayland-module.html">Wayland</a>
        </li>
        <li>
            <a href="Windows-module.html">Windows</a>
        </li>
	</ul>
</li>
<li class="dropdown">
	<a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		Quick References <span class="caret"></span>
	</a>
	<ul class="dropdown-menu" id="quick-refs-menu">
					<li>
				<a href="Reference-manual.html">Functions</a>
			</li>
					<li>
				<a href="Build-options.html">Options</a>
			</li>
					<li>
				<a href="Configuration.html">Configuration</a>
			</li>
					<li>
				<a href="Dependencies.html">Dependencies</a>
			</li>
					<li>
				<a href="Unit-tests.html">Tests</a>
			</li>
					<li>
				<a href="Syntax.html">Syntax</a>
			</li>
			</ul>
</li>
			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
				<p><b>The Meson Build System</b></p>
			</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="core" data-hotdoc-in-toplevel="True" data-hotdoc-project="Meson-documentation" data-hotdoc-ref="Rust-module.html" class="page_container" id="page-wrapper">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/full-width.js"></script>
  <div id="sitenav-wrapper">
    <iframe src="hotdoc-sitemap.html" id="sitenav-frame"></iframe>
  </div>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-role="main">
        <h1 id="rust-module">Rust module</h1>
<p><em>(new in 0.57.0)</em>
<em>(Stable since 1.0.0)</em></p>
<p>The rust module provides helper to integrate rust code into Meson. The
goal is to make using rust in Meson more pleasant, while still
remaining mesonic, this means that it attempts to make Rust work more
like Meson, rather than Meson work more like rust.</p>
<h2 id="functions">Functions</h2>
<h3 id="test">test()</h3>
<pre><code class="language-meson">rustmod.test(name, target, ...)
</code></pre>
<p>This function creates a new rust unittest target from an existing rust
based target, which may be a library or executable. It does this by
copying the sources and arguments passed to the original target and
adding the <code>--test</code> argument to the compilation, then creates a new
test target which calls that executable, using the rust test protocol.</p>
<p>This function takes two positional arguments, the first is the name of the
test and the second is the library or executable that is the rust based target.
It also takes the following keyword arguments:</p>
<ul>
<li>
<code>dependencies</code>: a list of test-only Dependencies</li>
<li>
<code>link_with</code>: a list of additional build Targets to link with (<em>since 1.2.0</em>)</li>
<li>
<code>link_whole</code>: a list of additional build Targets to link with in their entirety (<em>since 1.8.0</em>)</li>
<li>
<code>rust_args</code>: a list of extra arguments passed to the Rust compiler (<em>since 1.2.0</em>)</li>
</ul>
<p>This function  also accepts all of the keyword arguments accepted by the
<a href="Reference-manual_functions.html#test"><ins><code>test()</code></ins></a> function except <code>protocol</code>, it will set that automatically.</p>
<h3 id="doctest">doctest()</h3>
<pre><code class="language-meson">rustmod.doctest(name, target, ...)
</code></pre>
<p><em>Since 1.8.0</em></p>
<p>This function creates a new <code>test()</code> target from an existing rust
based library target. The test will use <code>rustdoc</code> to extract and run
the doctests that are included in <code>target</code>'s sources.</p>
<p>This function takes two positional arguments, the first is the name of the
test and the second is the library or executable that is the rust based target.
It also takes the following keyword arguments:</p>
<ul>
<li>
<code>dependencies</code>: a list of test-only Dependencies</li>
<li>
<code>link_with</code>: a list of additional build Targets to link with</li>
<li>
<code>link_whole</code>: a list of additional build Targets to link with in their entirety</li>
<li>
<code>rust_args</code>: a list of extra arguments passed to the Rust compiler</li>
</ul>
<p>The target is linked automatically into the doctests.</p>
<p>This function  also accepts all of the keyword arguments accepted by the
<a href="Reference-manual_functions.html#test"><ins><code>test()</code></ins></a> function except <code>protocol</code>, it will set that automatically.
However, arguments are limited to strings that do not contain spaces
due to limitations of <code>rustdoc</code>.</p>
<h3 id="bindgen">bindgen()</h3>
<p>This function wraps bindgen to simplify creating rust bindings around C
libraries. This has two advantages over invoking bindgen with a
<code>generator</code> or <code>custom_target</code>:</p>
<ul>
<li>It handles <code>include_directories</code>, so one doesn't have to manually convert them to <code>-I...</code>
</li>
<li>It automatically sets up a depfile, making the results more reliable</li>
<li>It automatically handles assertions, synchronizing Rust and C/C++ to have the same behavior</li>
</ul>
<p>It takes the following keyword arguments</p>
<ul>
<li>
<code>input</code>: a list of Files, Strings, or CustomTargets. The first element is
the header bindgen will parse, additional elements are dependencies.</li>
<li>
<code>output</code>: the name of the output rust file</li>
<li>
<code>output_inline_wrapper</code>: the name of the optional output c file containing
wrappers for static inline function. This requires <code>bindgen-0.65</code> or
newer (<em>since 1.3.0</em>).</li>
<li>
<code>include_directories</code>: A list of <code>include_directories</code> or <code>string</code> objects,
these are passed to clang as <code>-I</code> arguments <em>(string since 1.0.0)</em>
</li>
<li>
<code>c_args</code>: a list of string arguments to pass to clang untouched</li>
<li>
<code>args</code>: a list of string arguments to pass to <code>bindgen</code> untouched.</li>
<li>
<code>dependencies</code>: a list of <code>Dependency</code> objects to pass to the underlying clang call (<em>since 1.0.0</em>)</li>
<li>
<code>language</code>: A literal string value of <code>c</code> or <code>cpp</code>. When set this will force bindgen to treat a source as the given language. Defaults to checking based on the input file extension. <em>(since 1.4.0)</em>
</li>
<li>
<code>bindgen_version</code>: a list of string version values. When set the found bindgen binary must conform to these constraints. <em>(since 1.4.0)</em>
</li>
</ul>
<pre><code class="language-meson">rust = import('unstable-rust')

inc = include_directories('..'¸ '../../foo')

generated = rust.bindgen(
    input : 'myheader.h',
    output : 'generated.rs',
    include_directories : [inc, include_directories('foo')],
    args : ['--no-rustfmt-bindings'],
    c_args : ['-DFOO=1'],
)
</code></pre>
<p>If the header depends on generated headers, those headers must be passed to
<code>bindgen</code> as well to ensure proper dependency ordering, static headers do not
need to be passed, as a proper depfile is generated:</p>
<pre><code class="language-meson">h1 = custom_target(...)
h2 = custom_target(...)

r1 = rust.bindgen(
  input : [h1, h2],  # h1 includes h2,
  output : 'out.rs',
)
</code></pre>
<p><em>Since 1.1.0</em> Meson will synchronize assertions for Rust and C/C++  when the
<code>b_ndebug</code> option is set (via <code>-DNDEBUG</code> for C/C++, and <code>-C debug-assertions=on</code> for Rust), and will pass <code>-DNDEBUG</code> as an extra argument
to clang. This allows for reliable wrapping of <code>-DNDEBUG</code> controlled behavior
with <code>#[cfg(debug_asserions)]</code> and or <code>cfg!()</code>. Before 1.1.0, assertions for Rust
were never turned on by Meson.</p>
<p><em>Since 1.2.0</em> Additional arguments to pass to clang may be specified in a
*machine file in the properties section:</p>
<pre><code class="language-ini">[properties]
bindgen_clang_arguments = ['--target', 'x86_64-linux-gnu']
</code></pre>
<h3 id="proc_macro">proc_macro()</h3>
<pre><code class="language-meson">rustmod.proc_macro(name, sources, ...)
</code></pre>
<p><em>Since 1.3.0</em></p>
<p>This function creates a Rust <code>proc-macro</code> crate, similar to:</p>
<pre><code class="language-meson"><a href="Reference-manual_functions.html#shared_library"><ins><code>shared_library()</code></ins></a>(name, sources,
  rust_crate_type: 'proc-macro',
  native: true)
</code></pre>
<p><code>proc-macro</code> targets can be passed to <code>link_with</code> keyword argument of other Rust
targets.</p>
<p>Only a subset of <a href="Reference-manual_functions.html#shared_library"><ins><code>shared_library()</code></ins></a> keyword arguments are allowed:</p>
<ul>
<li>rust_args</li>
<li>rust_dependency_map</li>
<li>sources</li>
<li>dependencies</li>
<li>extra_files</li>
<li>link_args</li>
<li>link_depends</li>
<li>link_with</li>
<li>override_options</li>
</ul>
<h3 id="workspace">workspace()</h3>
<p>Basic usage:</p>
<pre><code>cargo_ws = rustmod.workspace()
</code></pre>
<p>With custom features:</p>
<pre><code>feature_list = get_feature('f1') ? ['feature1'] : []
feature_list += get_feature('f2') ? ['feature2'] : []
cargo_ws = rustmod.workspace(features: feature_list)
</code></pre>
<p><em>Since 1.11.0</em></p>
<p>Create and return a <code>workspace</code> object for managing the project's Cargo
workspace.</p>
<p>Keyword arguments:</p>
<ul>
<li>
<code>default_features</code>: (<code>bool</code>, optional) Whether to enable default features.</li>
<li>
<code>features</code>: (<code>list[str]</code>, optional) List of additional features to enable globally.</li>
</ul>
<p>A project that wishes to use Cargo subprojects should have <code>Cargo.lock</code> and <code>Cargo.toml</code>
files in the root source directory, and should call this function before using
Cargo subprojects.</p>
<p>The first invocation of <code>workspace()</code> establishes the <em>Cargo interpreter</em>
that resolves dependencies and features for both the toplevel project (the one
containing <code>Cargo.lock</code>) and all subprojects that are invoked with the <code>cargo</code> method,</p>
<p>You can optionally customize the feature set, by providing <code>default_features</code>
and <code>features</code> when the Cargo interpreter is established.  If any of these
arguments is not specified, <code>default_features</code> is taken as <code>true</code> and
<code>features</code> as the empty list.</p>
<p>Once established, the Cargo interpreter's configuration is locked. Later calls to
<code>workspace()</code> must either omit all arguments (accepting the existing configuration)
or provide the same set of features as the first call. Mismatched arguments will cause
a build error.</p>
<p>The recommendation is to not specify any keyword arguments in a subproject, so
that they simply inherit the parent's configuration.  Be careful about the
difference between specifying arguments and not doing so:</p>
<pre><code># always works regardless of parent configuration
cargo_ws = rustmod.workspace()

# fails if parent configured different features
cargo_ws = rustmod.workspace(default_features: true)
cargo_ws = rustmod.workspace(features: [])
</code></pre>
<p>The first form says "use whatever features are configured," while the latter forms
say "require this specific configuration," which may conflict with the parent project.</p>
<h2 id="workspace-object">Workspace object</h2>
<h3 id="workspacepackages">workspace.packages()</h3>
<pre><code class="language-meson">packages = ws.packages()
</code></pre>
<p>Returns a list of package names in the workspace.</p>
<h3 id="workspacesubproject">workspace.subproject()</h3>
<pre><code class="language-meson">package = ws.subproject(package_name, api)
</code></pre>
<p>Returns a <code>package</code> object for managing a specific package within the workspace.</p>
<p>Positional arguments:</p>
<ul>
<li>
<code>package_name</code>: (<code>str</code>) The name of the package to retrieve</li>
<li>
<code>api</code>: (<code>str</code>, optional) The version constraints for the package in Cargo format</li>
</ul>
<h2 id="package-object">Package object</h2>
<p>The package object returned by <code>workspace.subproject()</code> provides methods
for working with individual packages in a Cargo workspace.</p>
<h3 id="subprojectname">subproject.name()</h3>
<pre><code class="language-meson">name = pkg.name()
</code></pre>
<p>Returns the name of the subproject.</p>
<h3 id="subprojectversion">subproject.version()</h3>
<pre><code class="language-meson">version = pkg.version()
</code></pre>
<p>Returns the normalized version number of the subproject.</p>
<h3 id="subprojectapi">subproject.api()</h3>
<pre><code class="language-meson">api = pkg.api()
</code></pre>
<p>Returns the API version of the subproject, that is the version up to the first
nonzero element.</p>
<h3 id="subprojectfeatures">subproject.features()</h3>
<pre><code class="language-meson">features = pkg.features()
</code></pre>
<p>Returns selected features for a specific subproject.</p>
<h3 id="subprojectall_features">subproject.all_features()</h3>
<pre><code class="language-meson">all_features = pkg.all_features()
</code></pre>
<p>Returns all defined features for a specific subproject.</p>
<h3 id="subprojectdependency">subproject.dependency()</h3>
<pre><code class="language-meson">dep = subproject.dependency(...)
</code></pre>
<p>Returns a dependency object for the subproject that can be used with other Meson targets.</p>
<p><em>Note</em>: right now, this method is implemented on top of the normal Meson function
<a href="Reference-manual_functions.html#dependency"><ins><code>dependency()</code></ins></a>; this is subject to change in future releases.  It is recommended
to always retrieve a Cargo subproject's dependency object via this method.</p>
<p>Keyword arguments:</p>
<ul>
<li>
<code>rust_abi</code>: (<code>str</code>, optional) The ABI to use for the dependency. Valid values are
<code>'rust'</code>, <code>'c'</code>, or <code>'proc-macro'</code>. The package must support the specified ABI.</li>
</ul>

    </div>
        




		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<div id="footer">
		    
        
<hr>

<div class="license-description">
    Website licensing information are available on the <a href="legal.html">Legal</a> page.
</div>

        
<div class="copyrights-description">
		<p>
				© 								2020, 
				2021, 
				2022, 
				2024, 
													       	Dylan Baker 				(<a href="mailto:dylan@pnwbakers.com">dylan@pnwbakers.com</a>)
			</p>
		<p>
				© 								2025, 
													       	Paolo Bonzini 				(<a href="mailto:bonzini@gnu.org">bonzini@gnu.org</a>)
			</p>
	</div>


	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		<a href="https://github.com/mesonbuild/meson/edit/master/docs/markdown/Rust-module.md" data-hotdoc-role="edit-button">Edit on GitHub</a>

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>


<script src="assets/js/navbar_offset_scroller.js"></script>
</body>
</html>
