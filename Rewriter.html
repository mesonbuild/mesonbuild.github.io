<!DOCTYPE html>
<html lang="en">
<head>

<base href=".">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Meson file rewriter</title>

<link rel="stylesheet" href="assets/css/custom_bootstrap.css" type="text/css">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" href="assets/js/search/enable_search.css" type="text/css">

<link rel="stylesheet" href="assets/css/prism-tomorrow.css" type="text/css">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/isotope.pkgd.min.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/trie.js"></script>

<link rel="icon" type="image/png" href="assets/images/favicon.png">
<link rel="shortcut icon" href="assets/images/favicon.png">

</head>

<body class="no-script
" data-spy="scroll" data-target="#toc" data-offset="70">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<form class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/meson_logo.png" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
  <a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Modules <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" id="modules-menu">
			<li>
				<a href="CMake-module.html">CMake</a>
			</li>
					<li>
				<a href="Cuda-module.html">CUDA</a>
			</li>
					<li>
				<a href="Dlang-module.html">Dlang</a>
			</li>
					<li>
				<a href="Fs-module.html">Filesystem</a>
			</li>
					<li>
				<a href="Gnome-module.html">GNOME</a>
			</li>
					<li>
				<a href="Hotdoc-module.html">Hotdoc</a>
			</li>
					<li>
				<a href="i18n-module.html">i18n</a>
			</li>
					<li>
				<a href="Icestorm-module.html">Icestorm</a>
			</li>
					<li>
				<a href="Keyval-module.html">Keyval</a>
			</li>
					<li>
				<a href="Pkgconfig-module.html">Pkgconfig</a>
			</li>
					<li>
				<a href="Python-module.html">Python</a>
			</li>
					<li>
				<a href="Python-3-module.html">Python 3</a>
			</li>
					<li>
				<a href="Qt4-module.html">Qt4</a>
			</li>
					<li>
				<a href="Qt5-module.html">Qt5</a>
			</li>
					<li>
				<a href="RPM-module.html">RPM</a>
			</li>
					<li>
				<a href="SourceSet-module.html">SourceSet</a>
			</li>
					<li>
				<a href="Windows-module.html">Windows</a>
			</li>
			</ul>
</li>
<li class="dropdown">
	<a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		Quick References <span class="caret"></span>
	</a>
	<ul class="dropdown-menu" id="quick-refs-menu">
					<li>
				<a href="Reference-manual.html">Functions</a>
			</li>
					<li>
				<a href="Build-options.html">Options</a>
			</li>
					<li>
				<a href="Configuration.html">Configuration</a>
			</li>
					<li>
				<a href="Dependencies.html">Dependencies</a>
			</li>
					<li>
				<a href="Unit-tests.html">Tests</a>
			</li>
					<li>
				<a href="Syntax.html">Syntax</a>
			</li>
			</ul>
</li>
			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
				<p><b>The Meson Build System</b></p>
			</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="core" data-hotdoc-in-toplevel="True" data-hotdoc-project="Meson-documentation" data-hotdoc-ref="Rewriter.html" class="page_container" id="page-wrapper">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/navigation.js"></script>
	<script src="assets/js/sitemap.js"></script>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-role="main">
        <h1 id="meson-file-rewriter">Meson file rewriter</h1>
<p>Since version 0.50.0, meson has the functionality to perform some basic
modification on the <code>meson.build</code> files from the command line. The currently
supported operations are:</p>
<ul>
<li>For build targets:
<ul>
<li>Add/Remove source files</li>
<li>Add/Remove targets</li>
<li>Modify a select set of kwargs</li>
<li>Print some JSON information</li>
</ul>
</li>
<li>For dependencies:
<ul>
<li>Modify a select set of kwargs</li>
</ul>
</li>
<li>For the project function:
<ul>
<li>Modify a select set of kwargs</li>
<li>Modify the default options list</li>
</ul>
</li>
</ul>
<p>The rewriter has both, a normal command line interface and a "script mode". The
normal CLI is mostly designed for everyday use. The "script mode", on the
other hand, is meant to be used by external programs (IDEs, graphical
frontends, etc.)</p>
<p>The rewriter itself is considered stable, however the user interface and the
"script mode" API might change in the future. These changes may also break
backwards comaptibility to older releases.</p>
<p>We are also open to suggestions for API improvements.</p>
<h2 id="using-the-rewriter">Using the rewriter</h2>
<p>All rewriter functions are accessed via <code>meson rewrite</code>. The meson rewriter
assumes that it is run inside the project root directory. If this isn't the
case, use <code>--sourcedir</code> to specify the actual project source directory.</p>
<h3 id="adding-and-removing-sources">Adding and removing sources</h3>
<p>The most common operations will probably be the adding and removing of source
files to a build target. This can be easily done with:</p>
<pre><code class="language-bash">meson rewrite target &lt;target name/id&gt; {add/rm} [list of sources]
</code></pre>
<p>For instance, given the following example</p>
<pre><code class="language-meson">src = ['main.cpp', 'fileA.cpp']

exe1 = executable('testExe', src)
</code></pre>
<p>the source <code>fileB.cpp</code> can be added with:</p>
<pre><code class="language-bash">meson rewrite target testExe add fileB.cpp
</code></pre>
<p>After executing this command, the new <code>meson.build</code> will look like this:</p>
<pre><code class="language-meson">src = ['main.cpp', 'fileA.cpp', 'fileB.cpp']

exe1 = executable('testExe', src)
</code></pre>
<p>In this case, <code>exe1</code> could also have been used for the target name. This is
possible because the rewriter also searches for assignments and unique meson
IDs, which can be acquired with introspection. If there are multiple targets
with the same name, meson will do nothing and print an error message.</p>
<p>For more information see the help output of the rewriter target command.</p>
<h3 id="setting-the-project-version">Setting the project version</h3>
<p>It is also possible to set kwargs of specific functions with the rewriter. The
general command for setting or removing kwargs is:</p>
<pre><code class="language-bash">meson rewrite kwargs {set/delete} &lt;function type&gt; &lt;function ID&gt; &lt;key1&gt; &lt;value1&gt; &lt;key2&gt; &lt;value2&gt; ...
</code></pre>
<p>For instance, setting the project version can be achieved with this command:</p>
<pre><code class="language-bash">meson rewrite kwargs set project / version 1.0.0
</code></pre>
<p>Currently, only the following function types are supported:</p>
<ul>
<li>dependency</li>
<li>target (any build target, the function ID is the target name/ID)</li>
<li>project (the function ID must be <code>/</code> since project() can only be called once)</li>
</ul>
<p>For more information see the help output of the rewrite kwargs command.</p>
<h3 id="setting-the-project-default-options">Setting the project default options</h3>
<p>For setting and deleting default options, use the following command:</p>
<pre><code class="language-bash">meson rewrite default-options {set/delete} &lt;opt1&gt; &lt;value1&gt; &lt;opt2&gt; &lt;value2&gt; ...
</code></pre>
<h2 id="limitations">Limitations</h2>
<p>Rewriting a meson file is not guaranteed to keep the indentation of the modified
functions. Additionally, comments inside a modified statement will be removed.
Furthermore, all source files will be sorted alphabetically.</p>
<p>For instance adding <code>e.c</code> to srcs in the following code</p>
<pre><code class="language-meson"># Important comment

srcs = [
'a.c', 'c.c', 'f.c',
# something important about b
       'b.c', 'd.c', 'g.c'
]

# COMMENT
</code></pre>
<p>would result in the following code:</p>
<pre><code class="language-meson"># Important comment

srcs = [
  'a.c',
  'b.c',
  'c.c',
  'd.c',
  'e.c',
  'f.c',
  'g.c'
]

# COMMENT
</code></pre>
<h2 id="using-the-script-mode">Using the "script mode"</h2>
<p>The "script mode" should be the preferred API for third party programs, since
it offers more flexibility and higher API stability. The "scripts" are stored
in JSON format and executed with <code>meson rewrite command &lt;JSON file or string&gt;</code>.</p>
<p>The JSON format is defined as follows:</p>
<pre><code class="language-json">[
  {
    "type": "function to execute",
    ...
  }, {
    "type": "other function",
    ...
  },
  ...
]
</code></pre>
<p>Each object in the main array must have a <code>type</code> entry which specifies which
function should be executed.</p>
<p>Currently, the following functions are supported:</p>
<ul>
<li>target</li>
<li>kwargs</li>
<li>default_options</li>
</ul>
<h3 id="target-modification-format">Target modification format</h3>
<p>The format for the type <code>target</code> is defined as follows:</p>
<pre><code class="language-json">{
  "type": "target",
  "target": "target ID/name/assignment variable",
  "operation": "one of ['src_add', 'src_rm', 'target_rm', 'target_add', 'info']",
  "sources": ["list", "of", "source", "files", "to", "add, remove"],
  "subdir": "subdir where the new target should be added (only has an effect for operation 'tgt_add')",
  "target_type": "function name of the new target -- same as in the CLI (only has an effect for operation 'tgt_add')"
}
</code></pre>
<p>The keys <code>sources</code>, <code>subdir</code> and <code>target_type</code> are optional.</p>
<h3 id="kwargs-modification-format">kwargs modification format</h3>
<p>The format for the type <code>target</code> is defined as follows:</p>
<pre><code class="language-json">{
  "type": "kwargs",
  "function": "one of ['dependency', 'target', 'project']",
  "id": "function ID",
  "operation": "one of ['set', 'delete', 'add', 'remove', 'remove_regex', 'info']",
  "kwargs": {
    "key1": "value1",
    "key2": "value2",
    ...
  }
}
</code></pre>
<h3 id="default-options-modification-format">Default options modification format</h3>
<p>The format for the type <code>default_options</code> is defined as follows:</p>
<pre><code class="language-json">{
  "type": "default_options",
  "operation": "one of ['set', 'delete']",
  "options": {
    "opt1": "value1",
    "opt2": "value2",
    ...
  }
}
</code></pre>
<p>For operation <code>delete</code>, the values of the <code>options</code> can be anything (including <code>null</code>)</p>
<h2 id="extracting-information">Extracting information</h2>
<p>The rewriter also offers operation <code>info</code> for the types <code>target</code> and <code>kwargs</code>.
When this operation is used, meson will print a JSON dump to stderr, containing
all available information to the rewriter about the build target / function
kwargs in question.</p>
<p>The output format is currently experimental and may change in the future.</p>

    </div>
        




		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<div id="footer">
		    
        
<hr>

<div class="license-description">
    Website licensing information are available on the <a href="legal.html">Legal</a> page.
</div>


	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		<a href="https://github.com/mesonbuild/meson//edit/master/docs/builddir/markdown/Rewriter.md" data-hotdoc-role="edit-button">Edit on github</a>

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>


<script src="assets/js/navbar_offset_scroller.js"></script>
</body>
</html>
