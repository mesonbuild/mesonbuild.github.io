<!DOCTYPE html>
<html lang="en">
<head>

<base href=".">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Custom build targets</title>

<link rel="stylesheet" href="assets/css/custom_bootstrap.css" type="text/css">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" href="assets/js/search/enable_search.css" type="text/css">

<link rel="stylesheet" href="assets/css/prism-tomorrow.css" type="text/css">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/prism-keep-markup.js"></script>
<script src="assets/js/trie.js"></script>

<link rel="icon" type="image/png" href="assets/images/favicon.png">
<link rel="shortcut icon" href="assets/images/favicon.png">

</head>

<body class="no-script
">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<form class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/meson_logo.png" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
  <a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Modules <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" id="modules-menu">
        <li>
            <a href="CMake-module.html">CMake</a>
        </li>
        <li>
            <a href="Cuda-module.html">CUDA</a>
        </li>
        <li>
            <a href="Dlang-module.html">Dlang</a>
        </li>
        <li>
            <a href="External-Project-module.html">External Project</a>
        </li>
        <li>
            <a href="Fs-module.html">Filesystem</a>
        </li>
        <li>
            <a href="Gnome-module.html">GNOME</a>
        </li>
        <li>
            <a href="Hotdoc-module.html">Hotdoc</a>
        </li>
        <li>
            <a href="i18n-module.html">i18n</a>
        </li>
        <li>
            <a href="Icestorm-module.html">Icestorm</a>
        </li>
        <li>
            <a href="Java-module.html">Java</a>
        </li>
        <li>
            <a href="Keyval-module.html">Keyval</a>
        </li>
        <li>
            <a href="Pkgconfig-module.html">Pkgconfig</a>
        </li>
        <li>
            <a href="Python-3-module.html">Python 3</a>
        </li>
        <li>
            <a href="Python-module.html">Python</a>
        </li>
        <li>
            <a href="Qt4-module.html">Qt4</a>
        </li>
        <li>
            <a href="Qt5-module.html">Qt5</a>
        </li>
        <li>
            <a href="Qt6-module.html">Qt6</a>
        </li>
        <li>
            <a href="Rust-module.html">Rust</a>
        </li>
        <li>
            <a href="Simd-module.html">Simd</a>
        </li>
        <li>
            <a href="SourceSet-module.html">SourceSet</a>
        </li>
        <li>
            <a href="Wayland-module.html">Wayland</a>
        </li>
        <li>
            <a href="Windows-module.html">Windows</a>
        </li>
	</ul>
</li>
<li class="dropdown">
	<a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		Quick References <span class="caret"></span>
	</a>
	<ul class="dropdown-menu" id="quick-refs-menu">
					<li>
				<a href="Reference-manual.html">Functions</a>
			</li>
					<li>
				<a href="Build-options.html">Options</a>
			</li>
					<li>
				<a href="Configuration.html">Configuration</a>
			</li>
					<li>
				<a href="Dependencies.html">Dependencies</a>
			</li>
					<li>
				<a href="Unit-tests.html">Tests</a>
			</li>
					<li>
				<a href="Syntax.html">Syntax</a>
			</li>
			</ul>
</li>
			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
				<p><b>The Meson Build System</b></p>
			</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="core" data-hotdoc-in-toplevel="True" data-hotdoc-project="Meson-documentation" data-hotdoc-ref="Custom-build-targets.html" class="page_container" id="page-wrapper">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/navigation.js"></script>
	<script src="assets/js/sitemap.js"></script>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-role="main">
        <h1 id="custom-build-targets">Custom build targets</h1>
<p>While Meson tries to support as many languages and tools as possible,
there is no possible way for it to cover all corner cases. For these
cases it permits you to define custom build targets. Here is how one
would use it.</p>
<pre><code class="language-meson">comp = find_program('custom_compiler')

infile = 'source_code.txt'
outfile = 'output.bin'

mytarget = custom_target('targetname',
  output : outfile,
  input : infile,
  command : [comp, '@INPUT@', '@OUTPUT@'],
  install : true,
  install_dir : 'subdir')
</code></pre>
<p>This would generate the binary <code>output.bin</code> and install it to
<code>${prefix}/subdir/output.bin</code>. Variable substitution works just like
it does for source generation.</p>
<p>See <a href="Generating-sources.html">Generating Sources</a> for more information on this topic.</p>
<h2 id="details-on-command-invocation">Details on command invocation</h2>
<p>Meson only permits you to specify one command to run. This is by
design as writing shell pipelines into build definition files leads to
code that is very hard to maintain. If your command requires multiple
steps you need to write a wrapper script that does all the necessary
work.</p>
<p>When doing this you need to be mindful of the following issues:</p>
<ul>
<li>do not assume that the command is invoked in any specific directory</li>
<li>a target called <code>target</code> file <code>outfile</code> defined in subdir <code>subdir</code>
must be written to <code>build_dir/subdir/foo.dat</code>
</li>
<li>if you need a subdirectory for temporary files, use
<code>build_dir/subdir/target.dir</code>
</li>
</ul>
<h1 id="generating-a-full-subdirectory-of-files-since-0640">Generating a full subdirectory of files (since 0.64.0)</h1>
<p>There are many cases where one needs to generate a bunch of files
where the list of outputs is unknown. The most common case is
documentations. Tools like Doxygen, Sphinx and the like typically
generate a whole directory tree full of files that you would need to
install.</p>
<p>For this case Meson provides the <code>opaque_target</code> command. It is more
complex than other targets and typically require the developer to
write a small wrapper script that runs the actual tool. The syntax
looks like this.</p>
<pre><code class="language-meson">doc_target = opaque_target('docs',
    command: find_program('adaptor_script.py'),
    args: ['--some-flag'],
    install: true,
    install_dir: 'some_dir')
</code></pre>
<p>An <code>opaque_target</code> function behaves much like a <code>custom_target</code> with
the exception that it takes the command and arguments separately. This
is needed so that Meson can insert additional integration command line
arguments to the command line. When the script is executed, the
command line looks like this.</p>
<pre><code>adaptor_script.py --stamp=&lt;path&gt; --dep=&lt;path&gt; --scrath=&lt;dir&gt; \
  --out=&lt;dir&gt; -- --some-flag
</code></pre>
<p>The first arguments are as follows:</p>
<p><strong>--stamp</strong> is a <em>stamp file</em>. That is, the file whose existance and
time samp specify whether the target is up to date or not. Its
contents are ignored. When the script is run successfully it must
update the time stamp of this file, typically by opening it for
writing and closing it. If the script did not succeed the script
must delete this file if it exists. If a stamp file exists after
an unsuccessfull run, the resulting behaviour is undefined.</p>
<p><strong>--dep</strong> specifies the dependency file. That is, it should list all
the source files whose changes should cause the target to be
re-run. It should be in the same syntax (a subset of Make
dependencies) as produced by compilers like GCC and Clang. This
file <strong>must</strong> be written. If there is no dependency information
available, then the contents should be just a single line
consisting of the stamp file name followed by a colon. There must
<em>not</em> be a space between the two.</p>
<p><strong>--scratch</strong> points to a directory that can be used for temporary
processing. The contents of this file are persisted over
consecutive invocations but they are cleared on every <code>clean</code>
operation.</p>
<p><strong>--out</strong> points to a directory where the final output files should be
placed. They are copied as is on install (if the <code>install</code> kwarg
is <code>true</code>). If the script is invoked multiple times it is the
responsibility of the script to ensure that no stray files from
the first run remain in the dir after the second run.</p>
<p><em>--</em> signals the end of integration args. Additional scripts specified
in the target follow this one. Meson may add new integration
flags in the future, so the script must be able to handle any
unknown arguments before this marker (typically by ignoring
them).</p>

    </div>
        




		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<div id="footer">
		    
        
<hr>

<div class="license-description">
    Website licensing information are available on the <a href="legal.html">Legal</a> page.
</div>


	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		<a href="https://github.com/mesonbuild/meson/edit/master/docs/markdown/Custom-build-targets.md" data-hotdoc-role="edit-button">Edit on GitHub</a>

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>


<script src="assets/js/navbar_offset_scroller.js"></script>
</body>
</html>
