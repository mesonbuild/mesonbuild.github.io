<!DOCTYPE html>
<html lang="en">
<head>

<base href=".">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Adding new projects to WrapDB</title>

<link rel="stylesheet" href="assets/css/custom_bootstrap.css" type="text/css">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" href="assets/js/search/enable_search.css" type="text/css">

<link rel="stylesheet" href="assets/css/prism-tomorrow.css" type="text/css">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/isotope.pkgd.min.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/trie.js"></script>

<link rel="icon" type="image/png" href="assets/images/favicon.png">
<link rel="shortcut icon" href="assets/images/favicon.png">

</head>

<body class="no-script
" data-spy="scroll" data-target="#toc" data-offset="70">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<form class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/meson_logo.png" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
  <a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Modules <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" id="modules-menu">
			<li>
				<a href="CMake-module.html">CMake</a>
			</li>
					<li>
				<a href="Cuda-module.html">CUDA</a>
			</li>
					<li>
				<a href="Dlang-module.html">Dlang</a>
			</li>
					<li>
				<a href="Fs-module.html">Filesystem</a>
			</li>
					<li>
				<a href="Gnome-module.html">GNOME</a>
			</li>
					<li>
				<a href="Hotdoc-module.html">Hotdoc</a>
			</li>
					<li>
				<a href="i18n-module.html">i18n</a>
			</li>
					<li>
				<a href="Icestorm-module.html">Icestorm</a>
			</li>
					<li>
				<a href="Keyval-module.html">Keyval</a>
			</li>
					<li>
				<a href="Pkgconfig-module.html">Pkgconfig</a>
			</li>
					<li>
				<a href="Python-module.html">Python</a>
			</li>
					<li>
				<a href="Python-3-module.html">Python 3</a>
			</li>
					<li>
				<a href="Qt4-module.html">Qt4</a>
			</li>
					<li>
				<a href="Qt5-module.html">Qt5</a>
			</li>
					<li>
				<a href="RPM-module.html">RPM</a>
			</li>
					<li>
				<a href="SourceSet-module.html">SourceSet</a>
			</li>
					<li>
				<a href="Windows-module.html">Windows</a>
			</li>
			</ul>
</li>
<li class="dropdown">
	<a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		Quick References <span class="caret"></span>
	</a>
	<ul class="dropdown-menu" id="quick-refs-menu">
					<li>
				<a href="Reference-manual.html">Functions</a>
			</li>
					<li>
				<a href="Build-options.html">Options</a>
			</li>
					<li>
				<a href="Configuration.html">Configuration</a>
			</li>
					<li>
				<a href="Dependencies.html">Dependencies</a>
			</li>
					<li>
				<a href="Unit-tests.html">Tests</a>
			</li>
					<li>
				<a href="Syntax.html">Syntax</a>
			</li>
			</ul>
</li>
			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
				<p><b>The Meson Build System</b></p>
			</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="core" data-hotdoc-in-toplevel="True" data-hotdoc-project="Meson-documentation" data-hotdoc-ref="Adding-new-projects-to-wrapdb.html" class="page_container" id="page-wrapper">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/navigation.js"></script>
	<script src="assets/js/sitemap.js"></script>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-role="main">
        <h1 id="adding-new-projects-to-wrapdb">Adding new projects to WrapDB</h1>
<h2 id="how-it-works">How it works</h2>
<p>Each wrap repository has a master branch with only one initial commit and <em>no</em> wrap files.
And that is the only commit ever made on that branch.</p>
<p>For every release of a project a new branch is created. The new branch is named after the
the upstream release number (e.g. <code>1.0.0</code>). This branch holds a wrap file for
this particular release.</p>
<p>There are two types of wraps on WrapDB - regular wraps and wraps with Meson build
definition patches. A wrap file in a repository on WrapDB must have a name <code>upstream.wrap</code>.</p>
<p>Wraps with Meson build definition patches work in much the same way as Debian:
we take the unaltered upstream source package and add a new build system to it as a patch.
These build systems are stored as Git repositories on GitHub. They only contain build definition files.
You may also think of them as an overlay to upstream source.</p>
<p>Whenever a new commit is pushed into GitHub's project branch, a new wrap is generated
with an incremented version number. All the old releases remain unaltered.
New commits are always done via GitHub merge requests and must be reviewed by
someone other than the submitter.</p>
<p>Note that your Git repo with wrap must not contain the subdirectory of the source
release. That gets added automatically by the service. You also must not commit
any source code from the original tarball into the wrap repository.</p>
<h2 id="choosing-the-repository-name">Choosing the repository name</h2>
<p>Wrapped subprojects are used much like external dependencies. Thus
they should have the same name as the upstream projects.</p>
<p>NOTE: Repo names must fully match this regexp: <code>[a-z0-9._]+</code>.</p>
<p>If the project provides a pkg-config file, then the repository name should be
the same as the pkg-config name. Usually this is the name of the
project, such as <code>libpng</code>. Sometimes it is slightly different,
however. As an example the libogg project's chosen pkg-config name is
<code>ogg</code> instead of <code>libogg</code>, which is the reason why the repository is
named plain <code>ogg</code>.</p>
<p>If there is no a pkg-config file, the name the project uses/promotes should be used,
lowercase only (Catch2 -&gt; catch2).</p>
<p>If the project name is too generic or ambiguous (e.g. <code>benchmark</code>),
consider using <code>organization-project</code> naming format (e.g. <code>google-benchmark</code>).</p>
<h2 id="how-to-contribute-a-new-wrap">How to contribute a new wrap</h2>
<p>If the project already uses Meson build system, then only a wrap file - <code>upstream.wrap</code>
should be provided. In other case a Meson build definition patch - a set of <code>meson.build</code>
files - should be also provided.</p>
<h3 id="request-a-new-repository">Request a new repository</h3>
<p>Create an issue on the <a href="https://github.com/mesonbuild/wrapdb/issues">wrapdb bug tracker</a>
using <em>Title</em> and <em>Description</em> below as a template.</p>
<p><em>Title:</em> <code>new wrap: &lt;project_name&gt;</code></p>
<p><em>Description:</em></p>
<pre><code>upstream url: &lt;link_to_updastream&gt;
version: &lt;version_you_have_a_wrap_for&gt;
</code></pre>
<p>Wait until the new repository or branch is created. A link to the new repository or branch
will be posted in a comment to this issue.</p>
<p>NOTE: Requesting a branch is not necessary. WrapDB maintainer can create the branch and
modify the PR accordingly if the project repository exists.</p>
<h3 id="creating-the-wrap-contents">Creating the wrap contents</h3>
<p>Setting up the contents might seem a bit counterintuitive at
first. Just remember that the outcome needs to have one (and only one)
commit that has all the build definition files (i.e. <code>meson.build</code> and
<code>meson_options.txt</code> files) and <em>nothing else</em>. It is good practice to
have this commit in a branch whose name matches the release as
described above.</p>
<p>First you need to fork the repository to your own page using GitHub's
fork button. Then you can clone the repo to your local machine.</p>
<pre><code>git clone git@github.com:yourusername/libfoo.git foo-wrap
</code></pre>
<p>Create a new branch for your work:</p>
<pre><code>git checkout -b 1.0.0
</code></pre>
<p>If you are adding new changes to an existing branch, leave out the
<code>-b</code> argument.</p>
<p>Now you need to copy the source code for the original project to this
directory. If you already have it extracted somewhere, you'd do
something like this:</p>
<pre><code>cd /path/to/source/extract/dir
cp -r * /path/to/foo-wrap
</code></pre>
<p>Now all the files should be in the wrap directory. Do <em>not</em> add them
to Git, though. Neither now or at any time during this process. The
repo must contain only the newly created build files.</p>
<p>New release branches require an <code>upstream.wrap</code> file, so create one if
needed.</p>
<pre><code>${EDITOR} upstream.wrap
</code></pre>
<p>The file format is simple, see any existing wrapdb repo for the
content. The checksum is SHA-256 and can be calculated with the
following command on most unix-like operating systems:</p>
<pre><code>sha256sum path/to/libfoo-1.0.0.tar.gz
</code></pre>
<p>Under macOS the command is the following:</p>
<pre><code>shasum -a 256 path/to/libfoo-1.0.0.tar.gz
</code></pre>
<p>Now you can create the build files and work on them until the project
builds correctly.</p>
<pre><code>${EDITOR} meson.build meson_options.txt
</code></pre>
<p>When you are satisfied with the results, add the build files to Git
and push the result to GitHub.</p>
<pre><code>&lt;verify that your project builds and runs&gt;
git add upstream.wrap meson.build
git commit -a -m 'Add wrap files for libfoo-1.0.0'
git push -u origin 1.0.0
</code></pre>
<p>Now you should create a pull request on GitHub. Try to create it
against the correct branch rather than master (<code>1.0.0</code> branch in this
example). GitHub should do this automatically.</p>
<p>If the branch doesn't exist file a pull request against master.
WrapDB maintainers can fix it before merging.</p>
<p>If packaging review requires you to do changes, use the <code>--amend</code>
argument to <code>commit</code> so that your branch will continue to have only
one commit.</p>
<pre><code>${EDITOR} meson.build
git commit -a --amend
git push --force
</code></pre>
<h2 id="what-is-done-by-wrapdb-maintainers">What is done by WrapDB maintainers</h2>
<p><a href="Wrap-maintainer-tools.md">mesonwrap tools</a> must be used for the tasks
below.</p>
<h3 id="adding-new-project-to-the-wrap-provider-service">Adding new project to the Wrap provider service</h3>
<p>Each project gets its own repo. It is initialized like this:</p>
<pre><code>mesonwrap new_repo --homepage=$HOMEPAGE --directory=$NEW_LOCAL_PROJECT_DIR $PROJECT_NAME
</code></pre>
<p>The command creates a new repository and uploads it to GitHub.</p>
<p><code>--version</code> flag may be used to create a branch immediately.</p>
<h3 id="adding-a-new-branch-to-an-existing-project">Adding a new branch to an existing project</h3>
<p>Create a new branch whose name matches the upstream release number.</p>
<pre><code>git checkout master
git checkout -b 1.0.0
git push origin 1.0.0
(or from GitHub web page, remember to branch from master)
</code></pre>
<p>Branch names must fully match this regexp: <code>[a-z0-9._]+</code>.</p>
<h2 id="changes-to-original-source">Changes to original source</h2>
<p>The point of a wrap is to provide the upstream project with as few
changes as possible. Most projects should not contain anything more
than a few Meson definition files. Sometimes it may be necessary to
add a template header file or something similar. These should be held
at a minimum.</p>
<p>It should especially be noted that there must <strong>not</strong> be any patches
to functionality. All such changes must be submitted to upstream. You
may also host your own Git repo with the changes if you wish. The Wrap
system has native support for Git subprojects.</p>
<h2 id="reviewing-wraps">Reviewing wraps</h2>
<p>See <a href="Wrap-review-guidelines.html">Wrap review guidelines</a>.</p>

    </div>
        




		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<div id="footer">
		    
        
<hr>

<div class="license-description">
    Website licensing information are available on the <a href="legal.html">Legal</a> page.
</div>


	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		<a href="https://github.com/mesonbuild/meson//edit/master/docs/builddir/markdown/Adding-new-projects-to-wrapdb.md" data-hotdoc-role="edit-button">Edit on github</a>

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>


<script src="assets/js/navbar_offset_scroller.js"></script>
</body>
</html>
